#!/usr/bin/env bash

### Version 1.0.0
### Created by Erik Berglund
### https://github.com/erikberglund

#//////////////////////////////////////////////////////////////////////////////////////////////////
###
### DESCRIPTION
###
#//////////////////////////////////////////////////////////////////////////////////////////////////

# Starts serving a jekyll site with passed options, and opens the site in a web browser

#//////////////////////////////////////////////////////////////////////////////////////////////////
###
### VARIABLES
###
#//////////////////////////////////////////////////////////////////////////////////////////////////

# Path to the jekyll site root folder
site_folder="/Users/erikberglund/Documents/GitHub Private/erikberglund.github.io"

#//////////////////////////////////////////////////////////////////////////////////////////////////
###
### FUNCIONS
###
#//////////////////////////////////////////////////////////////////////////////////////////////////

parse_opts() {
    options=""
    while getopts "d" opt; do
        case ${opt} in
            d) options="${options} --draft" ;;
            \?) printf "%s\n" "Invalid option: -${OPTARG}" >&2; exit 1;;
            :) printf "%s\n" "Option -${OPTARG} requires an argument." >&2; exit 1;;
        esac
    done
}

#//////////////////////////////////////////////////////////////////////////////////////////////////
###
### MAIN SCRIPT
###
#//////////////////////////////////////////////////////////////////////////////////////////////////

# Parse passed arguments
parse_opts "${@}"

# Open site in web browser (before serving site, as that command will run until Command-C)
open "http://127.0.0.1:4000" &

# Change directory and start serving site
( cd "${site_folder}" && bundle exec jekyll serve ${options} )

exit 0
